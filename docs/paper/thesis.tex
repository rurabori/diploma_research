% arara: pdflatex
% arara: pdflatex
% arara: pdflatex


% options:
% thesis=B bachelor's thesis
% thesis=M master's thesis
% czech thesis in Czech language
% english thesis in English language
% hidelinks remove colour boxes around hyperlinks

\documentclass[thesis=M,english]{FITthesis}[2019/12/23]

\usepackage[utf8]{inputenc} % LaTeX source encoded as UTF-8

% \usepackage{subfig} %subfigures
% \usepackage{amsmath} %advanced maths
% \usepackage{amssymb} %additional math symbols

\usepackage{dirtree} %directory tree visualisation

\usepackage{listings}
\lstset{basicstyle=\ttfamily, language=C++}

\usepackage{amsmath}
\usepackage{tabularx}
% TODO: reenable minted if possible.
% \usepackage{minted}

% % list of acronyms
% \usepackage[acronym,nonumberlist,toc,numberedsection=autolabel]{glossaries}
% \iflanguage{czech}{\renewcommand*{\acronymname}{Seznam pou{\v z}it{\' y}ch zkratek}}{}
% \makeglossaries

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 
% EDIT THIS
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 

\department{Department of Theoretical Computer Science}
\title{Distrubuted Sparse Matrix-Vector Multiplication}
\authorGN{Boris} %author's given name/names
\authorFN{Rúra} %author's surname
\author{Boris Rúra} %author's name without academic degrees
\authorWithDegrees{Bc. Boris Rúra} %author's name with academic degrees
\supervisor{doc. Ing. Ivan Šimeček, Ph.D.}
\acknowledgements{TODO: make thanks}
\abstractEN{Summarize the contents and contribution of your work in a few sentences in English language.}
\abstractCS{V n{\v e}kolika v{\v e}t{\' a}ch shr{\v n}te obsah a p{\v r}{\' i}nos t{\' e}to pr{\' a}ce v {\v c}esk{\' e}m jazyce.}
\placeForDeclarationOfAuthenticity{Prague}
\keywordsCS{Replace with comma-separated list of keywords in Czech.}
\keywordsEN{Replace with comma-separated list of keywords in English.}
\declarationOfAuthenticityOption{1} %select as appropriate, according to the desired license (integer 1-6)
% \website{http://site.example/thesis} %optional thesis URL



\begin{document}

\tableofcontents
% \newacronym{CVUT}{{\v C}VUT}{{\v C}esk{\' e} vysok{\' e} u{\v c}en{\' i} technick{\' e} v Praze}
% \newacronym{FIT}{FIT}{Fakulta informa{\v c}n{\' i}ch technologi{\' i}}

\setsecnumdepth{part}
\chapter{Introduction}

\setsecnumdepth{all}

\chapter{Sparse matrix storage formats}

% TODO: chapter summary

\section{Sparse matrices}

A matrix is a rectangular array of numbers. The numbers in the array
are called the entries in the matrix. \cite{anton14} Matrix entries are usually addressed
by the column and row in the rectangle they occupy.

In numerical analysis and scientific computing, a sparse matrix or sparse array
is a matrix in which most of the elements are zero. There is no strict definition
regarding the proportion of zero-value elements for a matrix to qualify as sparse
but a common criterion is that the number of non-zero elements is roughly equal
to the number of rows or columns. By contrast, if most of the elements are non-zero,
the matrix is considered dense.
The number of zero-valued elements divided by the total number of elements (e.g., m × n for an m × n matrix) is sometimes referred to as the sparsity of the matrix.
\cite{efficientSDMM} The number of non zero elements of a sparse matrix is usually denoted
as $n_{nz}$ number of columns as $n$ and number of rows as $m$.

To better illustrate the storage formats, let us define sparse matrix $A$.
\begin{equation*}
	A =
	\begin{pmatrix}
		1 & 0 & 2 & 0 \\
		0 & 3 & 0 & 0 \\
		4 & 0 & 5 & 0 \\
		6 & 0 & 0 & 7
	\end{pmatrix}
\end{equation*}

\section{Coordinate (COO)}

Coordinate storage format, commonly referred to as COO.
The data structure consists of three arrays of length $n_{nz}$\cite{saad03:IMS}:

% TODO: this may be nicer if formated with minted or something similar.
\begin{enumerate}
	\itemsep=0em
	\item[vals] a real array containing all the real (or complex) values of the nonzero elements of A in any order.
	\item[row\_idx] an integer array containing their row indices.
	\item[col\_idx] a second integer array containing their column indices.
\end{enumerate}

Thus $A$ would be stored as:

\begin{table}[h!]
	\centering
	\begin{tabular}{ |l||c|c|c|c|c|c|c| }
		\hline
		vals     & 1 & 2 & 3 & 4 & 5 & 6 & 7 \\
		\hline
		row\_idx & 0 & 0 & 1 & 2 & 2 & 3 & 3 \\
		\hline
		col\_idx & 0 & 2 & 1 & 0 & 2 & 0 & 3 \\
		\hline
	\end{tabular}
	\caption{$A$ stored in COO format}
\end{table}


\section{Compressed Sparse Row (CSR)}

Compressed Sparse Row is probably the most popular format for storing general sparse matrices.
\cite{saad03:IMS} Similarly to the coordinate format, it too consists of three arrays.

% TODO: better lstinline.
\begin{enumerate}
	\itemsep=0em
	\item[vals] a real array of size $n_{nz}$ containing all the real (or complex) values of the nonzero elements of $A$
		stored in row major order.
	\item[col\_idx] a second integer array of size $n_{nz}$ containing their column indices.
	\item[row\_ptr] an integer array of size $m + 1$ containing offsets into \lstinline{vals} and
		\lstinline!col_idx!, at which each row of the matrix begins.
\end{enumerate}

This involves nonnegligible savings in storage.

\begin{table}[h!]
	\centering
	\begin{tabular}{ |l||c|c|c|c|c|c|c| }
		\hline
		vals     & 1 & 2 & 3 & 4 & 5 & 6 & 7 \\
		\hline
		col\_idx & 0 & 2 & 1 & 0 & 2 & 0 & 3 \\
		\hline
	\end{tabular} \\
	\begin{tabular}{ |l||c|c|c|c|c| }
		\hline
		row\_ptr & 0 & 2 & 3 & 5 & 6 \\
		\hline
	\end{tabular}
	\caption{$A$ stored in CSR format}
\end{table}

\section{Compressed Sparse Row 5 (CSR5)}

To achieve near-optimal load balance for matrices with any sparsity structures,
all nonzero entries are partitioned to multiple 2D tiles of the same size.
The CSR5 format has two tuning parameters: $\omega$ and $\sigma$, where $\omega$
is a tile’s width and $\sigma$ is its height. \cite{liu2015csr5}

Further, extra information is needed to efficiently compute
SpMV. For each tile, a tile pointer \lstinline!tile_ptr! and a tile descriptor \lstinline!tile_desc! are introduced. 
Meanwhile, the three arrays, i.e., row pointer \lstinline!row_ptr!, column index \lstinline!col_idx! and value val, 
of the classic CSR format are directly integrated. The only difference is that the \lstinline!col_idx! data and the \lstinline!vals!
data in each complete tile are in-place transposed (i.e., from row-major order to column-major order) for coalesced memory access from contiguous SIMD lanes.

\lstinline!tile_ptr! stores the for index of the first entry of the tile.

\chapter{State-of-the-art}
test
\chapter{Analysis and design}
test
\chapter{Realisation}

\setsecnumdepth{part}
\chapter{Conclusion}


\bibliographystyle{iso690}
\bibliography{ref}

\setsecnumdepth{all}
\appendix

\chapter{Acronyms}
% \printglossaries
\begin{description}
	\item[CSR5] Compressed Sparse Row 5
	\item[GUI] Graphical user interface
	\item[$n_{nz}$] Number of non-zero elements in a sparse matrix.
	\item[XML] Extensible markup language
\end{description}


\chapter{Contents of enclosed CD}

%change appropriately
\dirtree{%
	.1 readme.txt\DTcomment{the file with CD contents description}.
	.1 exe\DTcomment{the directory with executables}.
	.1 src\DTcomment{the directory of source codes}.
	.2 wbdcm\DTcomment{implementation sources}.
	.2 thesis\DTcomment{the directory of \LaTeX{} source codes of the thesis}.
	.1 text\DTcomment{the thesis text directory}.
	.2 thesis.pdf\DTcomment{the thesis text in PDF format}.
	.2 thesis.ps\DTcomment{the thesis text in PS format}.
}

\end{document}
